



##### 变量及流程控制语句

全局变量 @@

局部变量 @

声明  DECLARE @ 局部变量名 [AS] TYPE [,...... n]

赋值 SET @ 局部变量名 = 值|表达式

###### 流程控制

```sql
BEGIN
语句块
END
```





#### 存储过程

###### 定义

```sql
CREATE PROC[EDURE] 存储过程名
[{@参数名 数据类型} [=default] [output]]
AS
  SQL语句 [...n]
```

output：返回给调用者

###### 执行

EXEC[UTE]  存储过程名 [实参 [, output] [,......n]]

###### 删除

DROP PROC p_name

#### 触发器

是一种特殊的存储过程。
无需用户调用执行，当用户对表中的数据进行**UPDATE**、**INSERT**或**DELETE**操作时**自动触发执行**的，与相应操作构成一个**完整的事务**。
触发器通常用于保证业务规则和**数据完整性**，其主要优点是用户可以用编程的方法来实现复杂的处理逻辑和商业规则，能够完成比CHECK约束更为复杂的**数据完整性约束**。

##### 创建

```sql
CREATE TRIGGER
ON {表名|视图名}
{FOR | AFTER | INSTEAD OF}
{[INSERT] [,] [DELETE] [,] [UPDATE]}
AS
  SQL语句
```

* FOR、AFTER 引发触发器的语句执行成功再执行触发器  -- **后触发型触发器**
* INSTEAD OF 指定执行触发器，不执行触发的SQL语句  --  **前触发型触发器**

##### 触发器使用的两个逻辑工作表

**DELETED**表存储**DELETE**和**UPDATE**语句所影响的行副本，执行DELETE和UPDATE操作时，行从触发器表中删除，并传输到DELETED表中。
**INSERTED**表存储**INSERT**和**UPDATE**语句所影响的行副本，在执行插入或更新操作时，新建的行同时添加到INSERTED表和触发器表中。
执行数据增、删、改操作时，两个临时表由系统自动创建，可通过这两个**临时表**所记录的数据来判断对触发器表数据的修改是否正确。

